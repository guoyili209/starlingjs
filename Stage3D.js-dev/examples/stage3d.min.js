var stageJS;!function(a){var b=function(){function a(a,b,c,d){"undefined"==typeof c&&(c=!0),"undefined"==typeof d&&(d=4294967295),this._transparent=c,this._canvas=document.createElement("canvas"),this._canvas.width=a,this._canvas.height=b,this._context=this._canvas.getContext("2d"),this._rect={x:0,y:0,width:a,height:b},c||this.fillRect(this._rect,d)}return a.fromImageElement=function(b){var c=new a(b.width,b.height,!0);return c._context.drawImage(b,0,0,b.width,b.height,0,0,b.width,b.height),c},Object.defineProperty(a.prototype,"width",{get:function(){return this._canvas.width},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"height",{get:function(){return this._canvas.height},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"canvas",{get:function(){return this._canvas},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"imageData",{get:function(){return this._context.getImageData(0,0,this._canvas.width,this._canvas.height)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"rect",{get:function(){return this._rect},enumerable:!0,configurable:!0}),a.prototype.copyPixels=function(b,c,d){b instanceof a?this._context.drawImage(b.canvas,c.x,c.y,c.width,c.height,d.x,d.y,c.width,c.height):this._context.drawImage(b,c.x,c.y,c.width,c.height,d.x,d.y,c.width,c.height)},a.prototype.draw=function(b){b instanceof a?this._context.drawImage(b.canvas,0,0):this._context.drawImage(b,0,0)},a.prototype.fillRect=function(a,b){this._context.fillStyle=this.hexToRGBACSS(b),this._context.fillRect(a.x,a.y,a.width,a.height)},a.prototype.hexToRGBACSS=function(a){var b=(16711680&a)>>>16,c=(65280&a)>>>8,d=255&a;if(this._transparent)var e=((4278190080&a)>>>24)/255;else var e=1;return"rgba("+b+","+c+","+d+","+e+")"},a}();a.BitmapData=b}(stageJS||(stageJS={}));var stageJS;!function(a){!function(a){var b=function(){function a(a){this.type=void 0,this.target=void 0,this.type=a}return a.prototype.clone=function(){return new a(this.type)},a.CONTEXT3D_CREATE="CONTEXT3D_CREATE",a}();a.Event=b}(a.events||(a.events={}));a.events}(stageJS||(stageJS={}));var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},stageJS;!function(a){!function(b){var c=function(a){function b(){a.call(this,b.ERROR)}return __extends(b,a),b.ERROR="error",b}(a.events.Event);b.ErrorEvent=c}(a.events||(a.events={}));a.events}(stageJS||(stageJS={}));var stageJS;!function(a){!function(a){var b=function(){function a(a){"undefined"==typeof a&&(a=null),this.listeners=new Array,this.target=a||this}return a.prototype.addEventListener=function(a,b){void 0===this.listeners[a]&&(this.listeners[a]=new Array),-1===this.getEventListenerIndex(a,b)&&this.listeners[a].push(b)},a.prototype.removeEventListener=function(a,b){var c=this.getEventListenerIndex(a,b);-1!==c&&this.listeners[a].splice(c,1)},a.prototype.dispatchEvent=function(a){var b=this.listeners[a.type];if(void 0!==b){var c=b.length;a.target=this.target;for(var d=0;c>d;d++)b[d](a)}},a.prototype.getEventListenerIndex=function(a,b){if(void 0!==this.listeners[a])for(var c=this.listeners[a],d=c.length,e=0;d>e;e++)if(b==c[e])return e;return-1},a.prototype.hasEventListener=function(a,b){return null!=b?-1!==this.getEventListenerIndex(a,b):void 0!==this.listeners[a]?this.listeners[a].length>0:!1},a}();a.EventDispatcher=b}(a.events||(a.events={}));a.events}(stageJS||(stageJS={}));var stageJS;!function(a){!function(a){var b=function(){function a(){}return a.AXIS_ANGLE="axisAngle",a.EULER_ANGLES="eulerAngles",a.QUATERNION="quaternion",a}();a.Orientation3D=b}(a.geom||(a.geom={}));a.geom}(stageJS||(stageJS={}));var stageJS;!function(a){!function(a){var b=function(){function a(a,b,c,d){"undefined"==typeof a&&(a=0),"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=0),this.x=a,this.y=b,this.z=c,this.w=d}return Object.defineProperty(a.prototype,"length",{get:function(){return Math.sqrt(this.lengthSquared)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"lengthSquared",{get:function(){return this.x*this.x+this.y*this.y+this.z*this.z},enumerable:!0,configurable:!0}),a.angleBetween=function(a,b){return Math.acos(a.dotProduct(b)/(a.length*b.length))},a.distance=function(a,b){var c=a.x-b.x,d=a.y-b.y,e=a.z-b.z;return Math.sqrt(c*c+d*d+e*e)},a.prototype.add=function(b){return new a(this.x+b.x,this.y+b.y,this.z+b.z)},a.prototype.subtract=function(b){return new a(this.x-b.x,this.y-b.y,this.z-b.z)},a.prototype.incrementBy=function(a){this.x+=a.x,this.y+=a.y,this.z+=a.z},a.prototype.decrementBy=function(a){this.x-=a.x,this.y-=a.y,this.z-=a.z},a.prototype.equals=function(a,b){return"undefined"==typeof b&&(b=!1),this.x==a.x&&this.y==a.y&&this.z==a.z&&(b?this.w==a.w:!0)},a.prototype.nearEquals=function(a,b,c){"undefined"==typeof c&&(c=!1);var d=Math.abs;return d(this.x-a.x)<b&&d(this.y-a.y)<b&&d(this.z-a.z)<b&&(c?d(this.w-a.w)<b:!0)},a.prototype.clone=function(){return new a(this.x,this.y,this.z,this.w)},a.prototype.copyFrom=function(a){this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w},a.prototype.negate=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},a.prototype.scaleBy=function(a){this.x*=a,this.y*=a,this.z*=a},a.prototype.setTo=function(a,b,c){this.x=a,this.y=b,this.z=c},a.prototype.normalize=function(){var a=this.length;return 0!=a&&this.scaleBy(1/a),a},a.prototype.crossProduct=function(b){return new a(this.y*b.z-this.z*b.y,this.z*b.x-this.x*b.z,this.x*b.y-this.y*b.x)},a.prototype.dotProduct=function(a){return this.x*a.x+this.y*a.y+this.z*a.z},a.prototype.project=function(){0!=this.w&&(this.x/=this.w,this.y/=this.w,this.z/=this.w)},a.prototype.toString=function(){return"[Vector3D] (x:"+this.x+" ,y:"+this.y+", z:"+this.z+", w:"+this.w+")"},a.X_AXIS=new a(1,0,0),a.Y_AXIS=new a(0,1,0),a.Z_AXIS=new a(0,0,1),a}();a.Vector3D=b}(a.geom||(a.geom={}));a.geom}(stageJS||(stageJS={}));var stageJS;!function(a){!function(b){var c=function(){function c(a){"undefined"==typeof a&&(a=null),this.rawData=new Float32Array(null!=a&&16==a.length?a.slice(0):[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return Object.defineProperty(c.prototype,"determinant",{get:function(){return(this.rawData[0]*this.rawData[5]-this.rawData[4]*this.rawData[1])*(this.rawData[10]*this.rawData[15]-this.rawData[14]*this.rawData[11])-(this.rawData[0]*this.rawData[9]-this.rawData[8]*this.rawData[1])*(this.rawData[6]*this.rawData[15]-this.rawData[14]*this.rawData[7])+(this.rawData[0]*this.rawData[13]-this.rawData[12]*this.rawData[1])*(this.rawData[6]*this.rawData[11]-this.rawData[10]*this.rawData[7])+(this.rawData[4]*this.rawData[9]-this.rawData[8]*this.rawData[5])*(this.rawData[2]*this.rawData[15]-this.rawData[14]*this.rawData[3])-(this.rawData[4]*this.rawData[13]-this.rawData[12]*this.rawData[5])*(this.rawData[2]*this.rawData[11]-this.rawData[10]*this.rawData[3])+(this.rawData[8]*this.rawData[13]-this.rawData[12]*this.rawData[9])*(this.rawData[2]*this.rawData[7]-this.rawData[6]*this.rawData[3])},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"position",{get:function(){return new b.Vector3D(this.rawData[3],this.rawData[7],this.rawData[11])},enumerable:!0,configurable:!0}),c.prototype.append=function(a){var b=a.rawData[0],c=a.rawData[1],d=a.rawData[2],e=a.rawData[3],f=a.rawData[4],g=a.rawData[5],h=a.rawData[6],i=a.rawData[7],j=a.rawData[8],k=a.rawData[9],l=a.rawData[10],m=a.rawData[11],n=a.rawData[12],o=a.rawData[13],p=a.rawData[14],q=a.rawData[15],r=this.rawData[0],s=this.rawData[1],t=this.rawData[2],u=this.rawData[3],v=this.rawData[4],w=this.rawData[5],x=this.rawData[6],y=this.rawData[7],z=this.rawData[8],A=this.rawData[9],B=this.rawData[10],C=this.rawData[11],D=this.rawData[12],E=this.rawData[13],F=this.rawData[14],G=this.rawData[15];this.rawData[0]=b*r+c*v+d*z+e*D,this.rawData[1]=b*s+c*w+d*A+e*E,this.rawData[2]=b*t+c*x+d*B+e*F,this.rawData[3]=b*u+c*y+d*C+e*G,this.rawData[4]=f*r+g*v+h*z+i*D,this.rawData[5]=f*s+g*w+h*A+i*E,this.rawData[6]=f*t+g*x+h*B+i*F,this.rawData[7]=f*u+g*y+h*C+i*G,this.rawData[8]=j*r+k*v+l*z+m*D,this.rawData[9]=j*s+k*w+l*A+m*E,this.rawData[10]=j*t+k*x+l*B+m*F,this.rawData[11]=j*u+k*y+l*C+m*G,this.rawData[12]=n*r+o*v+p*z+q*D,this.rawData[13]=n*s+o*w+p*A+q*E,this.rawData[14]=n*t+o*x+p*B+q*F,this.rawData[15]=n*u+o*y+p*C+q*G},c.prototype.prepend=function(a){var b=a.rawData[0],c=a.rawData[1],d=a.rawData[2],e=a.rawData[3],f=a.rawData[4],g=a.rawData[5],h=a.rawData[6],i=a.rawData[7],j=a.rawData[8],k=a.rawData[9],l=a.rawData[10],m=a.rawData[11],n=a.rawData[12],o=a.rawData[13],p=a.rawData[14],q=a.rawData[15],r=this.rawData[0],s=this.rawData[1],t=this.rawData[2],u=this.rawData[3],v=this.rawData[4],w=this.rawData[5],x=this.rawData[6],y=this.rawData[7],z=this.rawData[8],A=this.rawData[9],B=this.rawData[10],C=this.rawData[11],D=this.rawData[12],E=this.rawData[13],F=this.rawData[14],G=this.rawData[15];this.rawData[0]=r*b+s*f+t*j+u*n,this.rawData[1]=r*c+s*g+t*k+u*o,this.rawData[2]=r*d+s*h+t*l+u*p,this.rawData[3]=r*e+s*i+t*m+u*q,this.rawData[4]=v*b+w*f+x*j+y*n,this.rawData[5]=v*c+w*g+x*k+y*o,this.rawData[6]=v*d+w*h+x*l+y*p,this.rawData[7]=v*e+w*i+x*m+y*q,this.rawData[8]=z*b+A*f+B*j+C*n,this.rawData[9]=z*c+A*g+B*k+C*o,this.rawData[10]=z*d+A*h+B*l+C*p,this.rawData[11]=z*e+A*i+B*m+C*q,this.rawData[12]=D*b+E*f+F*j+G*n,this.rawData[13]=D*c+E*g+F*k+G*o,this.rawData[14]=D*d+E*h+F*l+G*p,this.rawData[15]=D*e+E*i+F*m+G*q},c.prototype.appendScale=function(a,b,c){this.rawData[0]*=a,this.rawData[1]*=a,this.rawData[2]*=a,this.rawData[3]*=a,this.rawData[4]*=b,this.rawData[5]*=b,this.rawData[6]*=b,this.rawData[7]*=b,this.rawData[8]*=c,this.rawData[9]*=c,this.rawData[10]*=c,this.rawData[11]*=c},c.prototype.prependScale=function(a,b,c){this.rawData[0]*=a,this.rawData[1]*=b,this.rawData[2]*=c,this.rawData[4]*=a,this.rawData[5]*=b,this.rawData[6]*=c,this.rawData[8]*=a,this.rawData[9]*=b,this.rawData[10]*=c,this.rawData[12]*=a,this.rawData[13]*=b,this.rawData[14]*=c},c.prototype.appendTranslation=function(a,b,c){this.rawData[0]+=this.rawData[12]*a,this.rawData[1]+=this.rawData[13]*a,this.rawData[2]+=this.rawData[14]*a,this.rawData[3]+=this.rawData[15]*a,this.rawData[4]+=this.rawData[12]*b,this.rawData[5]+=this.rawData[14]*b,this.rawData[6]+=this.rawData[14]*b,this.rawData[7]+=this.rawData[15]*b,this.rawData[8]+=this.rawData[12]*c,this.rawData[9]+=this.rawData[13]*c,this.rawData[10]+=this.rawData[14]*c,this.rawData[11]+=this.rawData[15]*c},c.prototype.prependTranslation=function(a,b,c){this.rawData[3]=this.rawData[0]*a+this.rawData[1]*b+this.rawData[2]*c+this.rawData[3],this.rawData[7]=this.rawData[4]*a+this.rawData[5]*b+this.rawData[6]*c+this.rawData[7],this.rawData[11]=this.rawData[8]*a+this.rawData[9]*b+this.rawData[10]*c+this.rawData[11],this.rawData[15]=this.rawData[12]*a+this.rawData[13]*b+this.rawData[14]*c+this.rawData[15]},c.prototype.appendRotation=function(a,b,d){"undefined"==typeof d&&(d=null);var e=this.getRotateMatrix(b,a*c.DEG_2_RAD);d?(this.appendTranslation(-d.x,-d.y,-d.z),this.append(e),this.appendTranslation(d.x,d.y,d.z)):this.append(e)},c.prototype.prependRotation=function(a,b,d){"undefined"==typeof d&&(d=null);var e=this.getRotateMatrix(b,a*c.DEG_2_RAD);d?(this.prependTranslation(d.x,d.y,d.z),this.prepend(e),this.prependTranslation(-d.x,-d.y,-d.z)):this.prepend(e)},c.prototype.clone=function(){return new c(Array.prototype.slice.call(this.rawData))},c.prototype.copyColumnFrom=function(a,b){if(0>a||a>3)throw new Error("column error");this.rawData[a]=b.x,this.rawData[a+4]=b.y,this.rawData[a+8]=b.z,this.rawData[a+12]=b.w},c.prototype.copyColumnTo=function(a,b){if(0>a||a>3)throw new Error("column error");b.x=this.rawData[a],b.y=this.rawData[a+4],b.z=this.rawData[a+8],b.w=this.rawData[a+12]},c.prototype.copyFrom=function(a){this.rawData.set(a.rawData)},c.prototype.copyRawDataFrom=function(a,b,c){"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=!1),c&&this.transpose();var d=a.length-b;if(16>d)throw new Error("Arguments Error");d>16&&(d=16);for(var e=0;d>e;e++)this.rawData[e]=a[e+b];c&&this.transpose()},c.prototype.copyRawDataTo=function(a,b,c){if("undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=!1),c&&this.transpose(),b>0)for(var d=0;b>d;d++)a[d]=0;for(var e=this.rawData.length,f=0;e>f;f++)a[f+b]=this.rawData[f];c&&this.transpose()},c.prototype.copyRowFrom=function(a,b){if(0>a||a>3)throw new Error("row error");this.rawData[4*a+0]=b.x,this.rawData[4*a+1]=b.y,this.rawData[4*a+2]=b.z,this.rawData[4*a+3]=b.w},c.prototype.copyRowTo=function(a,b){if(0>a||a>3)throw new Error("row error");b.x=this.rawData[4*a],b.y=this.rawData[4*a+1],b.z=this.rawData[4*a+2],b.w=this.rawData[4*a+3]},c.prototype.copyToMatrix3D=function(a){a.rawData.set(this.rawData)},c.prototype.decompose=function(c){"undefined"==typeof c&&(c="eulerAngles");var d=[],e=this.clone(),f=e.rawData,g=new b.Vector3D(f[12],f[13],f[14]);f[12]=0,f[13]=0,f[14]=0;var h=new b.Vector3D;h.x=Math.sqrt(f[0]*f[0]+f[1]*f[1]+f[2]*f[2]),h.y=Math.sqrt(f[4]*f[4]+f[5]*f[5]+f[6]*f[6]),h.z=Math.sqrt(f[8]*f[8]+f[9]*f[9]+f[10]*f[10]),f[0]*(f[5]*f[10]-f[6]*f[9])-f[1]*(f[4]*f[10]-f[6]*f[8])+f[2]*(f[4]*f[9]-f[5]*f[8])<0&&(h.z=-h.z),f[0]/=h.x,f[1]/=h.x,f[2]/=h.x,f[4]/=h.y,f[5]/=h.y,f[6]/=h.y,f[8]/=h.z,f[9]/=h.z,f[10]/=h.z;var i=new b.Vector3D;switch(c){case a.geom.Orientation3D.AXIS_ANGLE:i.w=Math.acos((f[0]+f[5]+f[10]-1)/2);var j=Math.sqrt((f[6]-f[9])*(f[6]-f[9])+(f[8]-f[2])*(f[8]-f[2])+(f[1]-f[4])*(f[1]-f[4]));i.x=(f[6]-f[9])/j,i.y=(f[8]-f[2])/j,i.z=(f[1]-f[4])/j;break;case a.geom.Orientation3D.QUATERNION:var k=f[0]+f[5]+f[10];k>0?(i.w=Math.sqrt(1+k)/2,i.x=(f[6]-f[9])/(4*i.w),i.y=(f[8]-f[2])/(4*i.w),i.z=(f[1]-f[4])/(4*i.w)):f[0]>f[5]&&f[0]>f[10]?(i.x=Math.sqrt(1+f[0]-f[5]-f[10])/2,i.w=(f[6]-f[9])/(4*i.x),i.y=(f[1]+f[4])/(4*i.x),i.z=(f[8]+f[2])/(4*i.x)):f[5]>f[10]?(i.y=Math.sqrt(1+f[5]-f[0]-f[10])/2,i.x=(f[1]+f[4])/(4*i.y),i.w=(f[8]-f[2])/(4*i.y),i.z=(f[6]+f[9])/(4*i.y)):(i.z=Math.sqrt(1+f[10]-f[0]-f[5])/2,i.x=(f[8]+f[2])/(4*i.z),i.y=(f[6]+f[9])/(4*i.z),i.w=(f[1]-f[4])/(4*i.z));break;case a.geom.Orientation3D.EULER_ANGLES:i.y=Math.asin(-f[2]),1!=f[2]&&-1!=f[2]?(i.x=Math.atan2(f[6],f[10]),i.z=Math.atan2(f[1],f[0])):(i.z=0,i.x=Math.atan2(f[4],f[5]))}return d.push(g),d.push(i),d.push(h),d},c.prototype.identity=function(){this.rawData=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},c.interpolate=function(a,c,d){var e=(new b.Quaternion).fromMatrix3D(a),f=(new b.Quaternion).fromMatrix3D(c);return b.Quaternion.lerp(e,f,d).toMatrix3D()},c.prototype.interpolateTo=function(a,b){this.rawData.set(c.interpolate(this,a,b).rawData)},c.prototype.invert=function(){var a=this.determinant,b=Math.abs(a)>1e-11;if(b){a=1/a;var c=this.rawData[0],d=this.rawData[4],e=this.rawData[8],f=this.rawData[12],g=this.rawData[1],h=this.rawData[5],i=this.rawData[9],j=this.rawData[13],k=this.rawData[2],l=this.rawData[6],m=this.rawData[10],n=this.rawData[14],o=this.rawData[3],p=this.rawData[7],q=this.rawData[11],r=this.rawData[15];this.rawData[0]=a*(h*(m*r-n*q)-i*(l*r-n*p)+j*(l*q-m*p)),this.rawData[1]=-a*(g*(m*r-n*q)-i*(k*r-n*o)+j*(k*q-m*o)),this.rawData[2]=a*(g*(l*r-n*p)-h*(k*r-n*o)+j*(k*p-l*o)),this.rawData[3]=-a*(g*(l*q-m*p)-h*(k*q-m*o)+i*(k*p-l*o)),this.rawData[4]=-a*(d*(m*r-n*q)-e*(l*r-n*p)+f*(l*q-m*p)),this.rawData[5]=a*(c*(m*r-n*q)-e*(k*r-n*o)+f*(k*q-m*o)),this.rawData[6]=-a*(c*(l*r-n*p)-d*(k*r-n*o)+f*(k*p-l*o)),this.rawData[7]=a*(c*(l*q-m*p)-d*(k*q-m*o)+e*(k*p-l*o)),this.rawData[8]=a*(d*(i*r-j*q)-e*(h*r-j*p)+f*(h*q-i*p)),this.rawData[9]=-a*(c*(i*r-j*q)-e*(g*r-j*o)+f*(g*q-i*o)),this.rawData[10]=a*(c*(h*r-j*p)-d*(g*r-j*o)+f*(g*p-h*o)),this.rawData[11]=-a*(c*(h*q-i*p)-d*(g*q-i*o)+e*(g*p-h*o)),this.rawData[12]=-a*(d*(i*n-j*m)-e*(h*n-j*l)+f*(h*m-i*l)),this.rawData[13]=a*(c*(i*n-j*m)-e*(g*n-j*k)+f*(g*m-i*k)),this.rawData[14]=-a*(c*(h*n-j*l)-d*(g*n-j*k)+f*(g*l-h*k)),this.rawData[15]=a*(c*(h*m-i*l)-d*(g*m-i*k)+e*(g*l-h*k))}return b},c.prototype.pointAt=function(a,b,c){"undefined"==typeof b&&(b=null),"undefined"==typeof c&&(c=null),console.log("pointAt not impletement")},c.prototype.recompose=function(b,c){if("undefined"==typeof c&&(c="eulerAngles"),b.length<3)return!1;var d=b[2],e=b[0],f=b[1];return this.identity(),this.appendScale(d.x,d.y,d.z),this.append(this.getRotateMatrix(a.geom.Vector3D.X_AXIS,f.x)),this.append(this.getRotateMatrix(a.geom.Vector3D.Y_AXIS,f.y)),this.append(this.getRotateMatrix(a.geom.Vector3D.Z_AXIS,f.z)),this.rawData[12]=e.x,this.rawData[13]=e.y,this.rawData[14]=e.z,this.rawData[15]=1,!0},c.prototype.transformVector=function(a){return new b.Vector3D(a.x*this.rawData[0]+a.y*this.rawData[1]+a.z*this.rawData[2]+this.rawData[3],a.x*this.rawData[4]+a.y*this.rawData[5]+a.z*this.rawData[6]+this.rawData[7],a.x*this.rawData[8]+a.y*this.rawData[9]+a.z*this.rawData[10]+this.rawData[11],1)},c.prototype.deltaTransformVector=function(a){return new b.Vector3D(a.x*this.rawData[0]+a.y*this.rawData[1]+a.z*this.rawData[2],a.x*this.rawData[4]+a.y*this.rawData[5]+a.z*this.rawData[6],a.x*this.rawData[8]+a.y*this.rawData[9]+a.z*this.rawData[10],0)},c.prototype.transformVectors=function(a,c){for(var d=0,e=new b.Vector3D,f=new b.Vector3D;d+3<=a.length;)e.x=a[d],e.y=a[d+1],e.z=a[d+2],f=this.transformVector(e),c[d]=f.x,c[d+1]=f.y,c[d+2]=f.z,d+=3},c.prototype.transpose=function(){var a=this.rawData[1],b=this.rawData[2],c=this.rawData[3],d=this.rawData[4],e=this.rawData[6],f=this.rawData[7],g=this.rawData[8],h=this.rawData[9],i=this.rawData[11],j=this.rawData[12],k=this.rawData[13],l=this.rawData[14];this.rawData[1]=d,this.rawData[2]=g,this.rawData[3]=j,this.rawData[4]=a,this.rawData[6]=h,this.rawData[7]=k,this.rawData[8]=b,this.rawData[9]=e,this.rawData[11]=l,this.rawData[12]=c,this.rawData[13]=f,this.rawData[14]=i},c.prototype.toString=function(){for(var a="[Matrix3D]\n",b=0;b<this.rawData.length;b++)a+=this.rawData[b]+"  , ",(b+1)%4==0&&(a+="\n");return a},c.prototype.getRotateMatrix=function(a,b){var d,e=a.x,f=a.y,g=a.z,h=Math.cos(b),i=Math.sin(b);if(0!=e&&0==f&&0==g)d=new c([1,0,0,0,0,h,-i,0,0,i,h,0,0,0,0,1]);else if(0!=f&&0==e&&0==g)d=new c([h,0,i,0,0,1,0,0,-i,0,h,0,0,0,0,1]);else if(0!=g&&0==e&&0==f)d=new c([h,-i,0,0,i,h,0,0,0,0,1,0,0,0,0,1]);else{var j=a.lengthSquared;if(Math.abs(j-1)>1e-4){var k=1/Math.sqrt(j);e=a.x*k,f=a.y*k,g=a.z*k}var l=1-h;d=new c([e*e*l+h,e*f*l-g*i,e*g*l+f*i,0,e*f*l+g*i,f*f*l+h,f*g*l-e*i,0,e*g*l-f*i,f*g*l+e*i,g*g*l+h,0,0,0,0,1])}return d},c.DEG_2_RAD=Math.PI/180,c}();b.Matrix3D=c}(a.geom||(a.geom={}));a.geom}(stageJS||(stageJS={}));var stageJS;!function(a){!function(a){var b=function(){function b(a,b,c,d){"undefined"==typeof a&&(a=0),"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=1),this.x=0,this.y=0,this.z=0,this.w=1,this.x=a,this.y=b,this.z=c,this.w=d}return b.lerp=function(a,c,d){return a.x*c.x+a.y*c.y+a.z*c.z+a.w*c.w<0?new b(a.x+d*(-c.x-a.x),a.y+d*(-c.y-a.y),a.z+d*(-c.z-a.z),a.w+d*(-c.w-c.w)):new b(a.x+d*(c.x-a.x),a.y+d*(c.y-a.y),a.z+d*(c.z-a.z),a.w+d*(c.w-c.w))},b.prototype.fromMatrix3D=function(a){var b,c=a.rawData[0],d=a.rawData[1],e=a.rawData[2],f=a.rawData[4],g=a.rawData[5],h=a.rawData[6],i=a.rawData[8],j=a.rawData[9],k=a.rawData[10],l=c+g+k;return l>0?(b=1/(2*Math.sqrt(l+1)),this.x=(h-j)*b,this.y=(i-e)*b,this.z=(d-f)*b,this.w=.25/b):c>g&&c>k?(b=1/(2*Math.sqrt(1+c-g+k)),this.x=(f+d)*b,this.y=(e+i)*b,this.z=(j-h)*b,this.w=.25/b):g>c&&g>k?(b=1/Math.sqrt(1+g-c-k),this.x=.25/b,this.y=(j+h)*b,this.z=(e-i)*b,this.w=(f+d)*b):k>c&&k>g&&(b=1/Math.sqrt(1+k-c-g),this.x=(j+h)*b,this.y=.25/b,this.z=(f-d)*b,this.w=(e+i)*b),this},b.prototype.toMatrix3D=function(b){"undefined"==typeof b&&(b=null);var c=this.x+this.x,d=this.y+this.y,e=this.z+this.z,f=this.x*c,g=this.x*d,h=this.x*e,i=this.y*d,j=this.y*e,k=this.z*e,l=this.w*c,m=this.w*d,n=this.w*e;return b||(b=new a.Matrix3D),b.rawData[0]=1-(i+k),b.rawData[1]=g+n,b.rawData[2]=h-m,b.rawData[3]=0,b.rawData[4]=g-n,b.rawData[5]=1-(f+k),b.rawData[6]=j+l,b.rawData[7]=0,b.rawData[8]=h+m,b.rawData[9]=j-l,b.rawData[10]=1-(f+i),b.rawData[11]=0,b.rawData[12]=0,b.rawData[13]=0,b.rawData[14]=0,b.rawData[15]=1,b},b.prototype.fromAxisAngle=function(a,b){var c=.5*b,d=Math.sin(c),e=Math.cos(c);this.x=a.x*d,this.y=a.y*d,this.z=a.z*d,this.w=e},b.prototype.conjugate=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},b.prototype.toString=function(){return"[Quaternion] (x:"+this.x+" ,y:"+this.y+", z:"+this.z+", w:"+this.w+")"},b}();a.Quaternion=b}(a.geom||(a.geom={}));a.geom}(stageJS||(stageJS={}));var stageJS;!function(a){!function(a){var b=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.lookAtLH=function(a,b,c){var d=b.x-a.x,e=b.y-a.y,f=b.z-a.z,g=1/Math.sqrt(d*d+e*e+f*f);d*=g,e*=g,f*=g;var h=c.y*f-c.z*e,i=c.z*d-c.x*f,j=c.x*e-c.y*d;g=1/Math.sqrt(h*h+i*i+j*j),h*=g,i*=g,j*=g;var k=e*j-f*i,l=f*h-d*j,m=d*i-e*h;this.copyRawDataFrom([h,i,j,-(h*a.x+i*a.y+j*a.z),k,l,m,-(k*a.x+l*a.y+m*a.z),d,e,f,-(d*a.x+e*a.y+f*a.z),0,0,0,1])},b.prototype.lookAtRH=function(a,b,c){var d=a.x-b.x,e=a.y-b.y,f=a.z-b.z,g=1/Math.sqrt(d*d+e*e+f*f);d*=g,e*=g,f*=g;var h=c.y*f-c.z*e,i=c.z*d-c.x*f,j=c.x*e-c.y*d;g=1/Math.sqrt(h*h+i*i+j*j),h*=g,i*=g,j*=g;var k=e*j-f*i,l=f*h-d*j,m=d*i-e*h;this.copyRawDataFrom([h,i,j,-(h*a.x+i*a.y+j*a.z),k,l,m,-(k*a.x+l*a.y+m*a.z),d,e,f,-(d*a.x+e*a.y+f*a.z),0,0,0,1])},b.prototype.perspectiveOffCenterLH=function(a,b,c,d,e,f){this.copyRawDataFrom([2*e/(b-a),0,(a+b)/(a-b),0,0,2*e/(d-c),(c+d)/(c-d),0,0,0,(f+e)/(f-e),2*f*e/(e-f),0,0,1,0])},b.prototype.perspectiveLH=function(a,b,c,d){this.copyRawDataFrom([2*c/a,0,0,0,0,2*c/b,0,0,0,0,(d+c)/(d-c),2*d*c/(c-d),0,0,1,0])},b.prototype.perspectiveFieldOfViewLH=function(a,b,c,d){var e=1/Math.tan(a/2),f=e/b;this.copyRawDataFrom([f,0,0,0,0,e,0,0,0,0,(d+c)/(d-c),2*d*c/(c-d),0,0,1,0])},b.prototype.orthoOffCenterLH=function(a,b,c,d,e,f){this.copyRawDataFrom([2/(b-a),0,0,(a+b)/(a-b),0,2/(d-c),0,(c+d)/(c-d),0,0,2/(f-e),(e+f)/(e-f),0,0,0,1])},b.prototype.orthoLH=function(a,b,c,d){this.copyRawDataFrom([2/a,0,0,0,0,2/b,0,0,0,0,2/(d-c),(c+d)/(c-d),0,0,0,1])},b.prototype.perspectiveOffCenterRH=function(a,b,c,d,e,f){this.copyRawDataFrom([2*e/(b-a),0,(b+a)/(b-a),0,0,2*e/(d-c),(d+c)/(d-c),0,0,0,(e+f)/(e-f),2*e*f/(e-f),0,0,-1,0])},b.prototype.perspectiveRH=function(a,b,c,d){this.copyRawDataFrom([2*c/a,0,0,0,0,2*c/b,0,0,0,0,(c+d)/(c-d),2*c*d/(c-d),0,0,-1,0])},b.prototype.perspectiveFieldOfViewRH=function(a,b,c,d){var e=1/Math.tan(a/2),f=e/b;this.copyRawDataFrom([f,0,0,0,0,e,0,0,0,0,(d+c)/(c-d),2*c*d/(c-d),0,0,-1,0])},b.prototype.orthoOffCenterRH=function(a,b,c,d,e,f){this.copyRawDataFrom([2/(b-a),0,0,(a+b)/(a-b),0,2/(d-c),0,(c+d)/(c-d),0,0,-2/(f-e),(e+f)/(e-f),0,0,0,1])},b.prototype.orthoRH=function(a,b,c,d){this.copyRawDataFrom([2/a,0,0,0,0,2/b,0,0,0,0,-2/(d-c),(c+d)/(c-d),0,0,0,1])},b}(a.Matrix3D);a.PerspectiveMatrix3D=b}(a.geom||(a.geom={}));a.geom}(stageJS||(stageJS={}));var stageJS;!function(a){var b=function(){function a(){}return a.BYTES_4="bytes4",a.FLOAT_1="float1",a.FLOAT_2="float2",a.FLOAT_3="float3",a.FLOAT_4="float4",a}();a.Context3DVertexBufferFormat=b}(stageJS||(stageJS={}));var stageJS;!function(a){var b=function(){function a(){}return a.BGRA="bgra",a}();a.Context3DTextureFormat=b}(stageJS||(stageJS={}));var stageJS;!function(a){var b=function(){function a(){}return a.ALWAYS="always",a.EQUAL="equal",a.GREATER="greater",a.GREATER_EQUAL="greaterEqual",a.LESS="less",a.LESS_EQUAL="lessEqual",a.NEVER="never",a.NOT_EQUAL="notEqual",a}();a.Context3DCompareMode=b}(stageJS||(stageJS={}));var stageJS;!function(a){var b=function(){function b(){}return b.init=function(){b.ONE=a.Context3D.GL.ONE,b.ZERO=a.Context3D.GL.ZERO,b.SOURCE_COLOR=a.Context3D.GL.SRC_COLOR,b.DESTINATION_COLOR=a.Context3D.GL.DST_COLOR,b.SOURCE_ALPHA=a.Context3D.GL.SRC_ALPHA,b.DESTINATION_ALPHA=a.Context3D.GL.DST_ALPHA,b.ONE_MINUS_SOURCE_COLOR=a.Context3D.GL.ONE_MINUS_SRC_COLOR,b.ONE_MINUS_DESTINATION_COLOR=a.Context3D.GL.ONE_MINUS_DST_COLOR,b.ONE_MINUS_SOURCE_ALPHA=a.Context3D.GL.ONE_MINUS_SRC_ALPHA,b.ONE_MINUS_DESTINATION_ALPHA=a.Context3D.GL.ONE_MINUS_DST_ALPHA},b}();a.Context3DBlendFactor=b}(stageJS||(stageJS={}));var stageJS;!function(a){var b=function(){function a(){}return a.BACK="back",a.FRONT="front",a.FRONT_AND_BACK="frontAndBack",a.NONE="none",a}();a.Context3DTriangleFace=b}(stageJS||(stageJS={}));var stageJS;!function(a){var b=function(){function b(b,c){if(this._numVertices=b,this._data32PerVertex=c,this._glBuffer=a.Context3D.GL.createBuffer(),!this._glBuffer)throw new Error("Failed to create buffer")}return Object.defineProperty(b.prototype,"glBuffer",{get:function(){return this._glBuffer},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"data32PerVertex",{get:function(){return this._data32PerVertex},enumerable:!0,configurable:!0}),b.prototype.uploadFromVector=function(b,c,d){this._data=b,(0!=c||d!=this._numVertices)&&(b=b.slice(c*this._data32PerVertex,d*this._data32PerVertex)),a.Context3D.GL.bindBuffer(a.Context3D.GL.ARRAY_BUFFER,this._glBuffer),a.Context3D.GL.bufferData(a.Context3D.GL.ARRAY_BUFFER,new Float32Array(b),a.Context3D.GL.STATIC_DRAW),a.Context3D.GL.bindBuffer(a.Context3D.GL.ARRAY_BUFFER,null)},b.prototype.dispose=function(){a.Context3D.GL.deleteBuffer(this._glBuffer),this._glBuffer=null,this._data.length=0,this._numVertices=0,this._data32PerVertex=0},b}();a.VertexBuffer3D=b}(stageJS||(stageJS={}));var stageJS;!function(a){var b=function(){function b(b){this.numIndices=b,this._glBuffer=a.Context3D.GL.createBuffer()}return Object.defineProperty(b.prototype,"glBuffer",{get:function(){return this._glBuffer},enumerable:!0,configurable:!0}),b.prototype.uploadFromVector=function(b,c,d){this._data=b,(0!=c||d!=this.numIndices)&&(b=b.slice(c,c+d)),a.Context3D.GL.bindBuffer(a.Context3D.GL.ELEMENT_ARRAY_BUFFER,this._glBuffer),a.Context3D.GL.bufferData(a.Context3D.GL.ELEMENT_ARRAY_BUFFER,new Uint16Array(b),a.Context3D.GL.STATIC_DRAW),a.Context3D.GL.bindBuffer(a.Context3D.GL.ELEMENT_ARRAY_BUFFER,null)},b.prototype.dispose=function(){a.Context3D.GL.deleteBuffer(this._glBuffer),this._glBuffer=null,this.numIndices=0,this._data.length=0},b}();a.IndexBuffer3D=b}(stageJS||(stageJS={}));var stageJS;!function(a){var b=function(){function b(c,d,e,f,g){this._glTexture=a.Context3D.GL.createTexture(),this._streamingLevels=g,this._textureUnit=b.__texUnit++,this._width=c,this._height=d,this._format=e,this._forRTT=f,this._forRTT&&(a.Context3D.GL.bindTexture(a.Context3D.GL.TEXTURE_2D,this._glTexture),a.Context3D.GL.texParameteri(a.Context3D.GL.TEXTURE_2D,a.Context3D.GL.TEXTURE_MAG_FILTER,a.Context3D.GL.LINEAR),a.Context3D.GL.texParameteri(a.Context3D.GL.TEXTURE_2D,a.Context3D.GL.TEXTURE_MIN_FILTER,a.Context3D.GL.LINEAR_MIPMAP_NEAREST),a.Context3D.GL.texImage2D(a.Context3D.GL.TEXTURE_2D,0,a.Context3D.GL.RGBA,512,512,0,a.Context3D.GL.RGBA,a.Context3D.GL.UNSIGNED_BYTE,null),b._bindingTexture?a.Context3D.GL.bindTexture(a.Context3D.GL.TEXTURE_2D,b._bindingTexture):a.Context3D.GL.bindTexture(a.Context3D.GL.TEXTURE_2D,null),a.Context3D.GL.bindRenderbuffer(a.Context3D.GL.RENDERBUFFER,null),a.Context3D.GL.bindFramebuffer(a.Context3D.GL.FRAMEBUFFER,null))}return b.prototype.__getGLTexture=function(){return this._glTexture},Object.defineProperty(b.prototype,"textureUnit",{get:function(){return this._textureUnit},enumerable:!0,configurable:!0}),b.prototype.uploadFromBitmapData=function(b,c){"undefined"==typeof c&&(c=0),this._forRTT&&console.error("rtt texture"),b instanceof a.BitmapData?this.uploadFromImage(b.imageData,c):this.uploadFromImage(b,c)},b.prototype.uploadFromImage=function(c,d){if("undefined"==typeof d&&(d=0),a.Context3D.GL.activeTexture(a.Context3D.GL["TEXTURE"+this.textureUnit]),a.Context3D.GL.bindTexture(a.Context3D.GL.TEXTURE_2D,this._glTexture),b._bindingTexture=this._glTexture,a.Context3D.GL.texParameteri(a.Context3D.GL.TEXTURE_2D,a.Context3D.GL.TEXTURE_MAG_FILTER,a.Context3D.GL.LINEAR),0==this._streamingLevels?a.Context3D.GL.texParameteri(a.Context3D.GL.TEXTURE_2D,a.Context3D.GL.TEXTURE_MIN_FILTER,a.Context3D.GL.LINEAR):(a.Context3D.GL.texParameteri(a.Context3D.GL.TEXTURE_2D,a.Context3D.GL.TEXTURE_MIN_FILTER,a.Context3D.GL.LINEAR_MIPMAP_LINEAR),a.Context3D.GL.generateMipmap(a.Context3D.GL.TEXTURE_2D)),a.Context3D.GL.texImage2D(a.Context3D.GL.TEXTURE_2D,d,a.Context3D.GL.RGBA,a.Context3D.GL.RGBA,a.Context3D.GL.UNSIGNED_BYTE,c),!a.Context3D.GL.isTexture(this._glTexture))throw new Error("Error:Texture is invalid")},b.prototype.dispose=function(){a.Context3D.GL.bindTexture(a.Context3D.GL.TEXTURE_2D,null),b._bindingTexture=null,a.Context3D.GL.deleteTexture(this._glTexture),this._glTexture=null,this._streamingLevels=0},b.__texUnit=0,b}();a.Texture=b}(stageJS||(stageJS={}));var stageJS;!function(a){var b=function(){function b(){this._glProgram=a.Context3D.GL.createProgram()}return Object.defineProperty(b.prototype,"glProgram",{get:function(){return this._glProgram},enumerable:!0,configurable:!0}),b.prototype.dispose=function(){this._vShader&&(a.Context3D.GL.detachShader(this._glProgram,this._vShader),a.Context3D.GL.deleteShader(this._vShader),this._vShader=null),this._fShader&&(a.Context3D.GL.detachShader(this._glProgram,this._fShader),a.Context3D.GL.deleteShader(this._fShader),this._fShader=null),a.Context3D.GL.deleteProgram(this._glProgram),this._glProgram=null},b.prototype.upload=function(b,c){if("undefined"==typeof b&&(b="shader-vs"),"undefined"==typeof c&&(c="shader-fs"),this._vShader=this.loadShader(b,a.Context3D.GL.VERTEX_SHADER),this._fShader=this.loadShader(c,a.Context3D.GL.FRAGMENT_SHADER),!this._fShader||!this._vShader)throw new Error("loadShader error");if(a.Context3D.GL.attachShader(this._glProgram,this._vShader),a.Context3D.GL.attachShader(this._glProgram,this._fShader),a.Context3D.GL.linkProgram(this._glProgram),!a.Context3D.GL.getProgramParameter(this._glProgram,a.Context3D.GL.LINK_STATUS))throw new Error(a.Context3D.GL.getProgramInfoLog(this._glProgram))},b.prototype.loadShader=function(b,c){var d=document.getElementById(b);if(!d)throw new Error("cant find elementId: "+b);var e=a.Context3D.GL.createShader(c);if(a.Context3D.GL.shaderSource(e,d.innerHTML),a.Context3D.GL.compileShader(e),!a.Context3D.GL.getShaderParameter(e,a.Context3D.GL.COMPILE_STATUS))throw new Error(a.Context3D.GL.getShaderInfoLog(e));return e},b}();a.Program3D=b}(stageJS||(stageJS={}));var stageJS;!function(a){a.VERSION="0.3.0";var b=function(b){function c(a){b.call(this),this._context3D=null,this._canvas=a}return __extends(c,b),Object.defineProperty(c.prototype,"context3D",{get:function(){return this._context3D},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"stageWidth",{get:function(){return this._canvas.width},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"stageHeight",{get:function(){return this._canvas.height},enumerable:!0,configurable:!0}),c.prototype.requestContext3D=function(){return this._canvas?null!=this._context3D?this.onCreateSuccess():(this._canvas.addEventListener&&this._canvas.addEventListener("webglcontextcreationerror",this.onCreationError,!1),a.Context3D.GL=this.create3DContext(),null==a.Context3D.GL?this.onCreationError(null):(this._context3D=new a.Context3D,this.onCreateSuccess())):void 0},c.prototype.create3DContext=function(){for(var a=["webgl","experimental-webgl","webkit-3d","moz-webgl"],b=null,c=0;c<a.length;c++){try{b=this._canvas.getContext(a[c])}catch(d){}if(b)break}return b},c.prototype.onCreationError=function(b){"undefined"==typeof b&&(b=null),null!=b&&this._canvas.removeEventListener&&this._canvas.removeEventListener("webglcontextcreationerror",this.onCreationError,!1),this.dispatchEvent(new a.events.ErrorEvent)},c.prototype.onCreateSuccess=function(){var b=new a.events.Event(a.events.Event.CONTEXT3D_CREATE);b.target=this,this.dispatchEvent(b)},c}(a.events.EventDispatcher);a.Stage3D=b}(stageJS||(stageJS={}));var stageJS;!function(a){var b=function(){function b(){this._bendDisabled=!0,this._depthDisabled=!0,this._linkedProgram=null,this._vaCache={},this._vcCache={},this._vcMCache={},this._texCache={},a.Context3DBlendFactor.init()}return b.prototype.configureBackBuffer=function(a,c,d,e){"undefined"==typeof e&&(e=!0),b.GL.viewport(0,0,a,c),this._depthDisabled=e,e?(this._clearBit=b.GL.COLOR_BUFFER_BIT|b.GL.DEPTH_BUFFER_BIT|b.GL.STENCIL_BUFFER_BIT,b.GL.enable(b.GL.DEPTH_TEST),b.GL.enable(b.GL.STENCIL_TEST)):(this._clearBit=b.GL.COLOR_BUFFER_BIT,b.GL.disable(b.GL.DEPTH_TEST),b.GL.disable(b.GL.STENCIL_TEST))
},b.prototype.createVertexBuffer=function(b,c){return new a.VertexBuffer3D(b,c)},b.prototype.createIndexBuffer=function(b){return new a.IndexBuffer3D(b)},b.prototype.createTexture=function(b,c,d,e,f){return"undefined"==typeof f&&(f=0),new a.Texture(b,c,d,e,f)},b.prototype.setRenderToTexture=function(a,c,d,e,f){if("undefined"==typeof c&&(c=!1),"undefined"==typeof d&&(d=0),"undefined"==typeof e&&(e=0),"undefined"==typeof f&&(f=0),c?(this._clearBit=b.GL.COLOR_BUFFER_BIT|b.GL.DEPTH_BUFFER_BIT|b.GL.STENCIL_BUFFER_BIT,b.GL.enable(b.GL.DEPTH_TEST),b.GL.enable(b.GL.STENCIL_TEST)):(this._clearBit=b.GL.COLOR_BUFFER_BIT,b.GL.disable(b.GL.DEPTH_TEST),b.GL.disable(b.GL.STENCIL_TEST)),!this._rttFramebuffer){this._rttFramebuffer=b.GL.createFramebuffer(),b.GL.bindFramebuffer(b.GL.FRAMEBUFFER,this._rttFramebuffer);var g=b.GL.createRenderbuffer();b.GL.bindRenderbuffer(b.GL.RENDERBUFFER,g),b.GL.renderbufferStorage(b.GL.RENDERBUFFER,b.GL.DEPTH_COMPONENT16,512,512),b.GL.framebufferRenderbuffer(b.GL.FRAMEBUFFER,b.GL.DEPTH_ATTACHMENT,b.GL.RENDERBUFFER,g),b.GL.framebufferTexture2D(b.GL.FRAMEBUFFER,b.GL.COLOR_ATTACHMENT0,b.GL.TEXTURE_2D,a.__getGLTexture(),0)}b.GL.bindFramebuffer(b.GL.FRAMEBUFFER,this._rttFramebuffer)},b.prototype.setRenderToBackBuffer=function(){b.GL.bindFramebuffer(b.GL.FRAMEBUFFER,null)},b.prototype.createProgram=function(){return new a.Program3D},b.prototype.setVertexBufferAt=function(b,c,d,e){"undefined"==typeof d&&(d=0),"undefined"==typeof e&&(e="float4");var f=0;switch(e){case a.Context3DVertexBufferFormat.FLOAT_4:f=4;break;case a.Context3DVertexBufferFormat.FLOAT_3:f=3;break;case a.Context3DVertexBufferFormat.FLOAT_2:f=2;break;case a.Context3DVertexBufferFormat.FLOAT_1:f=1;break;case a.Context3DVertexBufferFormat.BYTES_4:f=4}if(0>=f)throw new Error("vertexBuffer format error");this._vaCache[b]={size:f,buffer:c.glBuffer,stride:4*c.data32PerVertex,offset:4*d},this._linkedProgram&&this.enableVA(b)},b.prototype.setProgramConstantsFromVector=function(a,b){if(b.length>4)throw new Error("data length > 4");this._vcCache[a]=b,this._linkedProgram&&this.enableVC(a)},b.prototype.setProgramConstantsFromMatrix=function(a,b,c){"undefined"==typeof c&&(c=!1),c&&b.transpose(),this._vcMCache[a]=b.rawData,this._linkedProgram&&this.enableVCM(a)},b.prototype.setTextureAt=function(a,b){this._texCache[a]=b,this._linkedProgram&&this.enableTex(a)},b.prototype.setProgram=function(a){if(null!=a&&a!=this._linkedProgram){this._linkedProgram=a,b.GL.useProgram(a.glProgram);var c;for(c in this._vaCache)this.enableVA(c);for(c in this._vcCache)this.enableVC(c);for(c in this._vcMCache)this.enableVCM(c);for(c in this._texCache)this.enableTex(c)}},b.prototype.clear=function(a,c,d,e,f,g,h){"undefined"==typeof a&&(a=0),"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=0),"undefined"==typeof e&&(e=1),"undefined"==typeof f&&(f=1),"undefined"==typeof g&&(g=0),"undefined"==typeof h&&(h=4294967295),b.GL.clearColor(a,c,d,e),b.GL.clearDepth(f),b.GL.clearStencil(g),b.GL.clear(this._clearBit)},b.prototype.setCulling=function(c){switch(b.GL.frontFace(b.GL.CW),c){case a.Context3DTriangleFace.NONE:b.GL.disable(b.GL.CULL_FACE);break;case a.Context3DTriangleFace.BACK:b.GL.enable(b.GL.CULL_FACE),b.GL.cullFace(b.GL.BACK);break;case a.Context3DTriangleFace.FRONT:b.GL.enable(b.GL.CULL_FACE),b.GL.cullFace(b.GL.FRONT);break;case a.Context3DTriangleFace.FRONT_AND_BACK:b.GL.enable(b.GL.CULL_FACE),b.GL.cullFace(b.GL.FRONT_AND_BACK)}},b.prototype.setDepthTest=function(c,d){switch(this._depthDisabled&&(b.GL.enable(b.GL.DEPTH_TEST),this._depthDisabled=!1),b.GL.depthMask(c),d){case a.Context3DCompareMode.LESS:b.GL.depthFunc(b.GL.LESS);break;case a.Context3DCompareMode.NEVER:b.GL.depthFunc(b.GL.NEVER);break;case a.Context3DCompareMode.EQUAL:b.GL.depthFunc(b.GL.EQUAL);break;case a.Context3DCompareMode.GREATER:b.GL.depthFunc(b.GL.GREATER);break;case a.Context3DCompareMode.NOT_EQUAL:b.GL.depthFunc(b.GL.NOTEQUAL);break;case a.Context3DCompareMode.ALWAYS:b.GL.depthFunc(b.GL.ALWAYS);break;case a.Context3DCompareMode.LESS_EQUAL:b.GL.depthFunc(b.GL.LEQUAL);break;case a.Context3DCompareMode.GREATER_EQUAL:b.GL.depthFunc(b.GL.GEQUAL)}},b.prototype.setBlendFactors=function(a,c){this._bendDisabled&&(b.GL.enable(b.GL.BLEND),this._bendDisabled=!1),b.GL.blendFunc(a,c)},b.prototype.drawTriangles=function(a,c,d){"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=-1),b.GL.bindBuffer(b.GL.ELEMENT_ARRAY_BUFFER,a.glBuffer),b.GL.drawElements(b.GL.TRIANGLES,0>d?a.numIndices:3*d,b.GL.UNSIGNED_SHORT,2*c)},b.prototype.drawLines=function(a,c,d){"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=-1),b.GL.bindBuffer(b.GL.ELEMENT_ARRAY_BUFFER,a.glBuffer),b.GL.drawElements(b.GL.LINES,0>d?a.numIndices:2*d,b.GL.UNSIGNED_SHORT,2*c)},b.prototype.drawPoints=function(a,c,d){"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=-1),b.GL.bindBuffer(b.GL.ELEMENT_ARRAY_BUFFER,a.glBuffer),b.GL.drawElements(b.GL.POINTS,0>d?a.numIndices:d,b.GL.UNSIGNED_SHORT,2*c)},b.prototype.drawLineLoop=function(a,c,d){"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=-1),b.GL.bindBuffer(b.GL.ELEMENT_ARRAY_BUFFER,a.glBuffer),b.GL.drawElements(b.GL.LINE_LOOP,0>d?a.numIndices:d,b.GL.UNSIGNED_SHORT,2*c)},b.prototype.drawLineStrip=function(a,c,d){"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=-1),b.GL.bindBuffer(b.GL.ELEMENT_ARRAY_BUFFER,a.glBuffer),b.GL.drawElements(b.GL.LINE_STRIP,0>d?a.numIndices:d,b.GL.UNSIGNED_SHORT,2*c)},b.prototype.drawTriangleStrip=function(a){b.GL.bindBuffer(b.GL.ELEMENT_ARRAY_BUFFER,a.glBuffer),b.GL.drawElements(b.GL.TRIANGLE_STRIP,a.numIndices,b.GL.UNSIGNED_SHORT,0)},b.prototype.drawTriangleFan=function(a){b.GL.bindBuffer(b.GL.ELEMENT_ARRAY_BUFFER,a.glBuffer),b.GL.drawElements(b.GL.TRIANGLE_FAN,a.numIndices,b.GL.UNSIGNED_SHORT,0)},b.prototype.present=function(){},b.prototype.enableVA=function(a){var c=b.GL.getAttribLocation(this._linkedProgram.glProgram,a);if(0>c)throw new Error("Fail to get the storage location of"+a);var d=this._vaCache[a];b.GL.bindBuffer(b.GL.ARRAY_BUFFER,d.buffer),b.GL.vertexAttribPointer(c,d.size,b.GL.FLOAT,!1,d.stride,d.offset),b.GL.enableVertexAttribArray(c)},b.prototype.enableVC=function(a){var c=b.GL.getUniformLocation(this._linkedProgram.glProgram,a);if(!c)throw new Error("Fail to get uniform "+a);var d=this._vcCache[a];b.GL["uniform"+d.length+"fv"](c,d)},b.prototype.enableVCM=function(a){var c=b.GL.getUniformLocation(this._linkedProgram.glProgram,a);if(!c)throw new Error("Fail to get uniform "+a);b.GL.uniformMatrix4fv(c,!1,this._vcMCache[a])},b.prototype.enableTex=function(a){var c=this._texCache[a];b.GL.activeTexture(b.GL["TEXTURE"+c.textureUnit]);var d=b.GL.getUniformLocation(this._linkedProgram.glProgram,a);b.GL.uniform1i(d,c.textureUnit)},b}();a.Context3D=b}(stageJS||(stageJS={}));